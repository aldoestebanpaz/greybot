"set -u", or "set -o nounset", makes use of unset variables an error. To test whether a variable is present when this is active without causing an error, you can check for [[ ${var-} ]] instead of [[ $var ]].
